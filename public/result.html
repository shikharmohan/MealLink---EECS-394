
<html>
  <head>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/parse/1.2.9/parse.min.js"></script>
  <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/ratchet/2.0.2/css/ratchet-theme-ios.css">
  <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/ratchet/2.0.2/css/ratchet-theme-ios.min.css">
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/ratchet/2.0.2/css/ratchet.css">
  <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/ratchet/2.0.2/css/ratchet.min.css">
  
  <script src="http://cdnjs.cloudflare.com/ajax/libs/ratchet/2.0.2/js/ratchet.js"></script>
  <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/ratchet/2.0.2/js/ratchet.min.js"></script>
  

  <!-- jquery ui -->
  <!-- <script src="./jquery-ui-1.9.2.js"></script> -->
  <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">

<!--initialize parse --> 
<script>
  Parse.initialize("oOL3TebXo0CCT8Mm8OWN72Dq7H1LwNvaGrSUmZ8I","kYZjxpsriEyaK25EhmKw8TfrU9je7ycVcTI6DC65")
</script>


<!-- 10.15 zexian zeng add this part to get user information -->
  <script>
  if(Parse.User.current() == null)
  {
    window.location.href = "./index.html";
  }
  </script> 
<!-- 10.15 end of zexian zeng 's edition ' -->

<!-- 10.15 zexian zeng add this part to get user information -->
  <script>
    
  </script> 
<!-- 10.15 end of zexian zeng 's edition ' -->


    
    <!-- Makes your prototype chrome-less once bookmarked to your phone's home screen -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <style>
    .btnEat{
      margin-left: 120px;
      margin-bottom: 10px;
      margin-top: 10px;
    }
      .btnSubmit{
      margin-left: 140px;
      margin-bottom: 10px;
      margin-top: 10px;
    }
    .divHeight1{
      height:50px;
      border:0px;

    }
    img{
      width:50px;
      height:50px;
      border-radius:30px;

    }
    .liPadding{
      padding-right:0px;
    }
    .person-name{
      display: inline-block;
      margin-left: 10px;
      font-size: 40px;
    }
    .availability{
      font-style:italic;
    }
    </style>


    <title>My ParseApp site</title>
  </head>
  <body>
    
    <div class="segmented-control">
      <a href="#facebook_result" class="control-item active">Facebook</a>
      <a href="#linkedin_result" class="control-item">LinkedIn</a>
      <a href="#nearby_result" class="control-item">Nearby</a>
    </div>

    <div class="card">

    <ul id="facebook_result" class="control-content active table-view">
      <li class="table-view-cell" id = "fbCell1"><img src="https://fbcdn-profile-a.akamaihd.net/hprofile-ak-xpf1/v/t1.0-1/c195.55.548.548/s50x50/988686_10151585715386130_1175639374_n.jpg?oh=0ad7492d5c08fd97b343d36de3666062&oe=54AA97E2&__gda__=1424741424_90547460036388f6f7559e80cdffc03a">
        <div class="person-name">Person0</div> 
        <div class="availability">Available: 12:30PM</div>
        <button class="btn btn-primary">Button
        </button>
      </li>
      <li class="table-view-cell" id = "fbCell2">Person1 <button class="btn btn-primary">Button</button></li>
      <li class="table-view-cell" id = "fbCell4">Person2 <button class="btn btn-negative">Button</button></li>
    </ul>

    <ul id="linkedin_result" class="control-content table-view">
      <li class="table-view-cell">Linkedin <button class="btn">Button</button></li>
      <li class="table-view-cell">Item 22 <button class="btn btn-primary">Button</button></li>
      <li class="table-view-cell">Item 33 <button class="btn btn-positive">Button</button></li>
      <li class="table-view-cell">Item 44 <button class="btn btn-negative">Button</button></li>
    </ul>

    <ul id="nearby_result" class="control-content table-view">
      <li class="table-view-cell">Nearby <button class="btn">Button</button></li>
      <li class="table-view-cell">Item 2 <button class="btn btn-primary">Button</button></li>
      <li class="table-view-cell">Item 3 <button class="btn btn-positive">Button</button></li>
      <li class="table-view-cell">Item 4 <button class="btn btn-negative">Button</button></li>
    </ul>
  </div>

  

    <!-- 10/15 zexian add this to call function when paged loaded  -->
    <script type="text/javascript">
      function codeAddress() {
        var currentUser = Parse.User.current();
        alert("" + currentUser.get('name'));  

        var friends_list = currentUser.get('friends');
        alert(friends_list);

        var friend_obj = JSON.parse(friends_list);
        
        var ids = [];
        for (var i = 0; i < friend_obj.length; i++){
          ids.push(friend_obj[i].id);
        }
        var friend_names = [];
        var friend_numbers = [];
        var friend_starttime = [];
        var friend_distance = [];
        //var friend_duration = [];
        var query = new Parse.Query("User");
        query.containedIn('fb_id', ids);
        query.find({
          success: function(results){
            for (var k = 0; k < results.length; k++)
            {
              var currFriend = results[k];
              friend_names.push(currFriend.get('name'));
              friend_numbers.push(currFriend.get('phone_number'));
              friend_starttime.push(currFriend.get('start_time'));
              friend_distance.push(currFriend.get('distance'));

            }
            buildRows(friend_names, friend_numbers, friend_starttime, friend_distance);
          },
          error: function(error){
            alert(JSON.stringify(error));
          }
        });
      }
      function buildRows(names, numbers, start, distance) {
        for(var i = 0; i < names.length; i++)
        {
          //append all the users here
          //$('')
        }
      }
      window.onload = codeAddress;
    </script>
    <!-- 10/15 zexian add this to call function when paged loaded  -->

    <script>
      var currentUser = Parse.User.current();
      var user_time = currentUser.get('start_time');
      var user_hour = user_time.getHours();
      var user_minute = user_time.getMinutes();
      var user_number = currentUser.get('phone_number');
      //function for determining which row cell goes here

      //get the selected user and fields
      var selected_name;
      var selected_number;


      var query = new Parse.Query("User");
      query.equalTo('name', selected_name);
      query.first({
        success: function(object){
          selected_name = object.get('name');
          selected_number = object.get('phone_number');
        },
        error: function(error){
          alert(JSON.stringify(error));
        }
      });


      $('#SMStestbutton').click(function(){
        console.log("button works");
        var msg = "Hi " + selected_name + "! I'm available at " + user_hour + ":" + user_minute + ". Message me back at " + user_number + "!" 
        var sendtonumber = "+1" + selected_number
        Parse.Cloud.run('sendSMS', { smsmessage: msg, number: sendtonumber}, {
          success: function(result) {
            // result is 'Hello world!'
            console.log("" + JSON.stringify(result));
          },
          error: function(error) {
            console.log("" + JSON.stringify(error));
          }
        });
      });

    </script>
   
  </body>
</html>
